# enable Alfresco "single user" to perform maintenance tasks, first review:
# jmx_command_line_example.sh
# set user "admin" (but could be anyone) as the only one able to log on: that applies to new logins only,
# who has logged in already will remain logged in so either inform them to log off or disconnect them
# from the admin console, your call.

#1 get a connection
alf_jmx_connect

#2 select the bean you'll be working with
bean Alfresco:Type=Configuration,Category=sysAdmin,id1=default

#3 set the allowed users parameter
set server.allowedusers=admin,admin1

#4 perform your maintenance tasks

#5 re-allow everybody to login to Alfresco
run revert



# extract repository.properties with Alfresco default values
# useful to know what is preconfigured

jar xvf /opt/alfresco/tomcat/webapps/alfresco/WEB-INF/lib/alfresco-repository-6.56.jar alfresco/repository.properties


# restore, hopefully, proper ACLs after a chmod disaster
# install sshfs from epel
#!/bin/bash
myPath="usr/bin"
for filename in /usr/bin/* ; do
       echo chmod --reference "/mnt/properACL/$myPath/$filename" "/$myPath/$filename"
done

# clean Alfresco and Solr , remember to drop the DB as well
$CATALINA_HOME/bin/shutdown.sh 90 -force ;
rm -rf /opt/alfresco/alf_data/contentstore          \
       /opt/alfresco/alf_data/contentstore.deleted  \
       /opt/alfresco/tomcat/logs/*                  \
       /opt/solr6/logs/*                            ;
       

#
tail -f /opt/alfresco/tomcat/logs/catalina.out

$CATALINA_HOME/bin/shutdown.sh 90 -force ; $CATALINA_HOME/bin/startup.sh

$CATALINA_HOME/bin/shutdown.sh 90 -force ; rm -f $CATALINA_HOME/logs/catalina.out ; $CATALINA_HOME/bin/startup.sh

/opt/alfresco-search-services/solr/bin/solr stop ; /opt/alfresco-search-services/solr/bin/solr start -force

# check key store and trust store

reset ; keytool -list -keystore /opt/alfresco/alf_data/keystore/ssl.keystore   -storetype JCEKS -storepass kT9X6oe68t -v
reset ; keytool -list -keystore /opt/alfresco/alf_data/keystore/ssl.truststore -storetype JCEKS -storepass kT9X6oe68t -v

keytool -list -keystore ./keystore -storetype JCEKS -storepass mp6yc0UD9e -keypass oKIWzVdEdA -v

vi /opt/alfresco/tomcat/logs/catalina.out


vi /opt/alfresco/tomcat/bin/setenv.sh

vi /opt/alfresco/tomcat/conf/server.xml

vi /opt/alfresco/tomcat/shared/classes/alfresco-global.properties




vi /opt/solr6/solrhome/solr.xml

vi /opt/alfresco-search-services/solrhome/conf/shared.properties

vi /opt/alfresco-search-services/solr.in.sh


cd /opt/
reset ; egrep --color -R 'ssl.repo.client.keystore' *
reset ; updatedb ; locate -r keystore$ | grep -v templates | while read file; do ls -ltr $file; done | sort
reset ; updatedb ; locate -r keystore$ | grep -v templates | while read file; do sha1sum $file; done | sort
reset ; updatedb ; locate -r store.passwords.properties | grep -v templates | while read file; do echo $file ; enca -L none $file; done

keytool -list -keystore ssl.repo.client.keystore -storetype JCEKS -storepass kT9X6oe68t
keytool -importkeystore -srckeystore ssl.repo.client.keystore.jks -srcstoretype JCEKS -destkeystore ssl.repo.client.keystore.p12 -deststoretype pkcs12
